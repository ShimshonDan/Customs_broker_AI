from typing import Dict, Any

HS_SCHEMA: Dict[str, Any] = {
    "type": "object",
    "additionalProperties": False,
    "properties": {
        "eaeu_hs_code": {
            "type": "string",
            "description": "Код ТН ВЭД ЕАЭС 10-значный",
            "pattern": r"^\d{10}$"
        },
        "confidence": {"type": "number", "minimum": 0, "maximum": 1},
        "explanations": {
            "type": "array",
            "minItems": 5,
            "maxItems": 5,
            "items": {"type": "string"},
            "description": "Ровно 5 строк объяснений, почему выбран код"
        },
        "candidate_codes": {
            "type": "array",
            "items": {
                "type": "object",
                "additionalProperties": False,
                "properties": {
                    "code": {"type": "string", "pattern": r"^\d{6,10}$"},
                    "why_not": {"type": "string"}
                },
                "required": ["code", "why_not"]
            }
        },
        "evidence_urls": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Ссылки на первоисточники (ЕАЭС/РФ классификаторы, примечания к разделам, пояснения к ТН ВЭД, каталоги производителя и т.п.)"
        },
        "notes": {"type": "string"}
    },
    "required": ["eaeu_hs_code", "confidence", "explanations"]
}

DT_INSTRUCTION_RU = """Ты — эксперт по классификации товаров по ТН ВЭД ЕАЭС (HS/EAEU).
Задача: для описанной позиции (описание, модель/артикул, материалы, функции, масса/габариты, происхождение, контекст инвойса/PL/CMR/контракта) подобрать ОДИН 10-значный код ТН ВЭД ЕАЭС и выдать объяснение.

Обязательные правила:
1) Выполни поиск в интернете и СРАВНИ несколько источников (официальные пояснения к ТН ВЭД ЕАЭС/РФ, примечания к разделам/группам/позициям/субпозициям; базы решений таможни/судебная практика; каталоги/даташиты производителя).
2) Верни строго валидный JSON по схеме (без текста вне JSON).
3) В "explanations" дай РОВНО 5 логичных, коротких, нумерации не нужно, строк — почему выбран код (критерии классификации, примечания, ключевые признаки товара).
4) Если есть близкие альтернативы — укажи их в candidate_codes с кратким обоснованием "почему не они".
5) Код — именно ТН ВЭД ЕАЭС (10 знаков), не только HS-6.
6) Ссылки-улики положи в evidence_urls (не меньше 2, если возможно).

Формат входных данных:
- Контекст сделки: валюта/Incoterms могут быть даны — используй только если помогают понять комплектность.
- Сопоставляй PL и Invoice: если в PL есть материал/вес/комплектация — учти.
- Страна происхождения не влияет напрямую на код, но помогает найти техописание производителя.

Верни JSON по схеме: {eaeu_hs_code, confidence, explanations[5], candidate_codes[], evidence_urls[], notes}."""
